name: build

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout main
        uses: actions/checkout@v4
        with:
          ref: main

      - name: Ejecutar script de generación
        run: |
          chmod +x data-sync/public/generate.sh
          ./data-sync/public/generate.sh

      - name: Configurar git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Commit de cambios en main
        run: |
          git add -A
          git commit -m "Actualizar data" || echo "No hay cambios que commitear"

      - name: Push a main
        run: |
          git push origin main

      # ==== PUBLICACIÓN EN GH-PAGES ====

      - name: Checkout gh-pages en carpeta separada
        uses: actions/checkout@v4
        with:
          ref: gh-pages
          path: ghp

      - name: Copiar datos generados hacia gh-pages
        run: |
          rm -rf ghp/*
          cp -r public/generated/* ghp/

      - name: Commit en gh-pages
        run: |
          cd ghp
          git add -A
          git commit -m "Publicación automática" || echo "No hay cambios que commitear"

      - name: Push a gh-pages
        run: |
          cd ghp
          git push origin gh-pages
